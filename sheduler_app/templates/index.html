<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ Python-—Ñ–∞–π–ª–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .layout { display: flex; gap: 2rem; margin-top: 1.5rem; }
        .file-list { flex: 0 0 300px; max-height: 80vh; overflow-y: auto; }
        .report-area { flex: 1; }
        .file-item { padding: 0.5rem; border-radius: 4px; cursor: pointer; }
        .file-item:hover { background-color: #f1f1f1; }
        .file-item.active { background-color: #e7f3ff; border-right: 3px solid #0d6efd; }
        .issue-item { padding: 0.75rem; border-left: 4px solid #0d6efd; margin-bottom: 0.75rem; background: #f8f9fa; border-radius: 4px; }
        .issue-bandit { border-left-color: #dc3545; }
        .issue-pylint { border-left-color: #ffc107; }
        .issue-flake8 { border-left-color: #198754; }
        .no-issues { color: #6c757d; font-style: italic; }
        .path-text { font-family: monospace; font-size: 0.875em; color: #6c757d; }
    </style>
</head>
<body class="bg-light">

<div class="container py-4">
    <h1 class="mb-4">üîç –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä Python-–ø—Ä–æ–µ–∫—Ç–æ–≤</h1>

    <!-- Flash-—Å–æ–æ–±—â–µ–Ω–∏—è -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- –í–≤–æ–¥ –ø—É—Ç–∏ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            üìÅ –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
        </div>
        <div class="card-body">
            <form method="POST">
                <div class="mb-3">
                    <label for="project_path" class="form-label">–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å Python-—Ñ–∞–π–ª–∞–º–∏</label>
                    <input type="text" class="form-control" name="project_path" id="project_path" placeholder="/home/user/myproject" required>
                </div>
                <button type="submit" class="btn btn-primary">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –º–∞–∫–µ—Ç: —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ + –æ—Ç—á–µ—Ç -->
    {% if files and files|length > 0 %}
    <div class="layout">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
        <div class="file-list card">
            <div class="card-header d-flex justify-content-between align-items-center">
                üìÑ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
                <a href="{{ url_for('refresh_all') }}" class="btn btn-sm btn-outline-secondary">–û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ</a>
            </div>
            <ul class="list-group list-group-flush">
                {% for key, info in files.items() %}
                    <li class="list-group-item p-0">
                        <a href="{{ url_for('index', key=key) }}" 
                           class="file-item w-100 d-block text-decoration-none text-dark 
                                  {% if key == selected_key %}active{% endif %}">
                            <div>{{ info.filename }}</div>
                            <div class="path-text">{{ info.display_path }}</div>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –æ—Ç—á–µ—Ç -->
        <div class="report-area">
            {% if selected_key and selected_file_info %}
            <div class="card">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    üìä –û—Ç—á–µ—Ç: <strong>{{ selected_file_info.filename }}</strong>
                    <div>
                        <span class="badge bg-secondary me-2">{{ selected_file_info.display_path }}</span>
                        <a href="{{ url_for('refresh', key=selected_key) }}" class="btn btn-sm btn-warning">–û–±–Ω–æ–≤–∏—Ç—å</a>
                    </div>
                </div>
                <div class="card-body">

                    <!-- Bandit -->
                    <div class="mb-4">
                        <h5 class="tool-header">üõ° Bandit (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)</h5>
                        {% for issue in report.bandit %}
                            <div class="issue-item issue-bandit">
                                <small>{{ issue }}</small>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Pylint -->
                    <div class="mb-4">
                        <h5 class="tool-header">üßπ Pylint (–∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞)</h5>
                        {% for issue in report.pylint %}
                            <div class="issue-item issue-pylint">
                                <small>{{ issue }}</small>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Flake8 -->
                    <div class="mb-4">
                        <h5 class="tool-header">‚ùÑÔ∏è Flake8 (—Å—Ç–∏–ª—å –∏ –æ—à–∏–±–∫–∏)</h5>
                        {% for issue in report.flake8 %}
                            <div class="issue-item issue-flake8">
                                <small>{{ issue }}</small>
                            </div>
                        {% endfor %}
                    </div>

                </div>
            </div>
            {% else %}
                <div class="card">
                    <div class="card-body text-center text-muted">
                        ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å–ª–µ–≤–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–∞
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>